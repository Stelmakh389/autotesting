{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
    {% if form.instance.pk %}Редактирование{% else %}Создание{% endif %} группы оборудования
{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>{% if form.instance.pk %}Редактирование{% else %}Создание{% endif %} группы оборудования</h2>
    </div>
    <div class="card-body">
        <form method="post" class="needs-validation" novalidate>
            {% csrf_token %}
            
            <!-- Название группы -->
            <div class="mb-4">
                {{ form.name|as_crispy_field }}
            </div>

            <!-- Выбор оборудования -->
            <div class="mb-4">
                {{ form.equipment|as_crispy_field }}
            </div>

            <!-- Условия отображения -->
            <div class="mb-4">
                <h4>Условия отображения</h4>
                <p class="text-muted">Добавьте условия, при которых эта группа оборудования будет использоваться в протоколе.</p>
                
                <!-- Контейнер для условий -->
                <div id="conditions-container"></div>
                
                <!-- Кнопка добавления условия -->
                <button type="button" class="btn btn-primary" id="add-condition-btn">
                    <i class="bi bi-plus-lg"></i> Добавить условие
                </button>

                <!-- Скрытое поле для хранения JSON с условиями -->
                {{ form.conditions }}
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">Сохранить</button>
                <a href="{% url 'equipment:group_list' %}" class="btn btn-secondary">Отмена</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="{% static 'js/group_conditions.js' %}"></script>
<script>
$(document).ready(function() {
    // Инициализация Select2 для выбора оборудования
    $('#id_equipment').select2({
        placeholder: "Выберите оборудование",
        allowClear: true,
        width: '100%'
    });
});
</script>
{% endblock %}